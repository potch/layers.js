var Layers=function(t){"use strict";const e=(t,e,i)=>t+i*(e-t);const i=(t,i,h)=>[e(t[0],i[0],h),e(t[1],i[1],h),e(t[2],i[2],h),e(t[3],i[3],h)];function h(t,e,i){if(e<0||i<0||e>=t.width||i>=t.height){return[0,0,0,0]}let h=(i*t.width+e)*4;return t.data.slice(h,h+4)}function l(t,e,i,h,l,a,s){let r=(i*t.width+e)*4;t.data[r]=h;t.data[r+1]=l;t.data[r+2]=a;t.data[r+3]=s}const a=(t,e)=>{let i=t[3]/255;let h=e[3]/255;return[t[0]*i+e[0]*h*(1-i),t[1]*i+e[1]*h*(1-i),t[2]*i+e[2]*h*(1-i),(i+h*(1-i))*255]};function s(t,e,l){let a=Math.floor(e);let s=Math.ceil(e);let r=Math.floor(l);let n=Math.ceil(l);let o=(e%1+1)%1;let f=(l%1+1)%1;return i(i(h(t,a,r),h(t,s,r),o),i(h(t,a,n),h(t,s,n),o),f)}const r=(t,i,h,l)=>e(e(t,i,l),e(i,h,l),l);const n=(t,i,h,l,a)=>e(r(t,i,h,a),r(i,h,l,a),a);function o(t,e,i,h,l){return[n(0,t,i,1,l),n(0,e,h,1,l)]}function f(t,e,i,h,l){let a=.5;let s=.5;const r=1/512;while(s>r){let r=o(t,e,i,h,a)[0];let n=o(t,e,i,h,Math.min(a+s,1))[0];let f=o(t,e,i,h,Math.max(a-s,0))[0];let g=Math.abs(r-l);let d=Math.abs(n-l);let c=Math.abs(f-l);if(d<c&&d<g){a=Math.min(a+s,1)}else if(c<d&&c<g){a=Math.max(a-s,0)}s=s/2}return a}function g(t,e,i,h,l){return o(t,e,i,h,f(t,e,i,h,l))}var d=Object.freeze({__proto__:null,lerp:e,clerp:i,getPixel:h,setPixel:l,paint:a,samplePixel:s,bezier3:r,bezier4:n,bezier:o,bezierAlgebraic:f,bezierByX:g});const c=d;const m={};const w=t=>typeof t!=="undefined";const u=/^(\d+(\.\d+)?)%$/;const y=({x:t=0,y:e=0,width:i,height:h,x2:l,y2:a})=>{if(!w(i)&&w(l)){i=Math.abs(l-t)}if(t>l){[l,t]=[t,l]}if(!w(h)&&w(a)){h=Math.abs(a-e)}if(e>a){[a,e]=[e,a]}return{x:t,y:e,width:i,height:h}};function p(t,e,i,h){let l=t.width/2;let a=t.height/2;let s=e.width/2;let r=e.height/2;if(h){if(h.x){let t=h.x;if(typeof t==="string"){if(u.test(t)){let e=parseFloat(t.match(u)[1])/100;l=t.width*e}else if(t==="left"){l=0}else if(t==="right"){l=t.width}}if(typeof t==="number"){l=t}}if(h.y){let t=h.y;if(typeof t==="string"){if(u.test(t)){let i=parseFloat(t.match(u)[1])/100;a=e.height*i}else if(t==="top"){a=0}else if(t==="bottom"){a=e.height}}if(typeof t==="number"){a=t}}}if(i){if(i.x){let t=i.x;if(typeof t==="string"){if(u.test(t)){let i=parseFloat(t.match(u)[1])/100;s=e.width*i}else if(t==="left"){s=0}else if(t==="right"){s=e.width}}if(typeof t==="number"){r=t}}if(i.y){let t=i.y;if(typeof t==="string"){if(u.test(t)){let i=parseFloat(t.match(u)[1])/100;r=e.height*i}else if(t==="top"){r=0}else if(t==="bottom"){r=e.height}}if(typeof t==="number"){r=t}}}return{x:s-l,y:r-a}}class x{constructor({canvas:t,width:e,height:i,layers:h,container:l}){this.layers=h||[];this.canvas=t||document.createElement("canvas");if(l){if(l instanceof HTMLElement){l.append(this.canvas)}else if(typeof l==="string"){document.querySelector(l).append(this.canvas)}}this.width=e;this.height=i}layer(t){if(typeof t==="number"){return this.layers[t]}else if(typeof t==="string"){return this.layers.find(e=>e.name===t)}}async draw(){let t=this.canvas.getContext("2d");t.clearRect(0,0,this.width,this.height);for(let e=this.layers.length-1;e>=0;e--){let i=this.layers[e];if(i.disabled)continue;t.save();t.globalCompositeOperation=i.mode||"source-over";t.globalAlpha=i.opacity||1;if(i.transform){if(i.transform.x||i.transform.y){t.translate(i.transform.x||0,i.transform.y||0)}if(i.transform.rotate){t.translate(this.width/2,this.height/2);t.rotate(i.transform.rotate*Math.PI/180);t.translate(-this.width/2,-this.height/2)}}if(i.image){let e=i.image.source;if(i.image.url){try{e=await this.loadImage(i.image.url)}catch(t){console.warn("Unable to load image "+i.image.url,t)}}if(e){let h=i.image.anchor;let l=i.image.position;let a=i.image.size;let s=e.width;let r=e.height;if(a.width){s=a.width;if(!a.height){r=e.height/e.width*s}}if(a.height){r=a.height;if(!a.height){s=e.width/e.height*r}}if(a==="cover"){let t=Math.min(e.width/this.width,e.height/this.height);s=e.width/t;r=e.height/t}if(a==="contain"){let t=Math.max(e.width/this.width,e.height/this.height);s=e.width/t;r=e.height/t}if(typeof a==="string"&&u.test(a)){let t=parseFloat(a.match(u)[1])/100;let i=Math.max(e.width/this.width,e.height/this.height);s=e.width/i*t;r=e.height/i*t}let n=p({width:s,height:r},y(this),l,h);t.drawImage(e,n.x,n.y,s,r)}}else if(i.draw){await i.draw(t,this)}else if(i.filter){let e=await i.filter(t.getImageData(0,0,this.width,this.height),i.filterOptions);t.putImageData(e,0,0)}else if(i.group){let e=new x({width:this.width,height:this.height,layers:i.group});await e.draw();t.drawImage(e.canvas,0,0)}else if(i.text){let e=i.font||{};let h=e.family||"sans-serif";let l=e.size||"12px";let a=e.weight||"normal";t.fillStyle=i.color||"#000";t.strokeStyle=i.stroke||"#000";t.lineWidth=i.strokeWidth||1;t.font=`${a} ${l} ${h}`;t.textAlign=e.align||"center";t.textBaseline=e.verticalAlign||"middle";let s=i.position;let r=p({width:0,height:0},this,s);if("stroke"in i){t.lineJoin="round";t.strokeText(i.text,r.x,r.y)}t.fillText(i.text,r.x,r.y)}else if(i.shape){let e=i.shape;let h=e.anchor;let l=e.position;let a=0;let s=0;if(e.width){let t=e.width;if(typeof t==="string"&&u.test(t)){let e=parseFloat(t.match(u)[1])/100;a=this.width*e}else{a=t}if(!("height"in e)){s=t}}if(e.height){let t=e.height;if(typeof t==="string"&&u.test(t)){let e=parseFloat(t.match(u)[1])/100;s=this.height*e}else{s=t}if(!("width"in e)){a=t}}let r=p({width:a,height:s},this,l,h);t.fillStyle=i.fill;t.strokeStyle=i.stroke;let n=e.type;if(n==="ellipse"){t.beginPath();t.ellipse(r.x+a/2,r.y+s/2,a/2,s/2,0,0,Math.PI*2);t.fill()}else{t.fillRect(r.x,r.y,a,s)}}else if(i.fill){t.fillStyle=i.fill;t.fillRect(0,0,this.width,this.height)}t.restore()}return this.canvas}loadImage(t){if(m[t]){return m[t]}return new Promise((e,i)=>{let h=new Image;h.crossOrigin="anonymous";h.onload=()=>{m[t]=h;e(h)};h.onerror=()=>i();h.src=t})}set width(t){this.canvas.width=t}get width(){return this.canvas.width}set height(t){this.canvas.height=t}get height(){return this.canvas.height}}const{setPixel:M,samplePixel:b,getPixel:v}=d;const F={GrayscaleFilter(t){let e=t.data;for(let t=0;t<e.length;t=t+4){let i=e[t];let h=e[t+1];let l=e[t+2];let a=.299*i+.587*h+.114*l;e[t]=e[t+1]=e[t+2]=a}return t},ContrastFilter(t,{amount:e}){let i=t.data;for(let t=0;t<i.length;t=t+4){i[t]=(i[t]-128)*e+128;i[t+1]=(i[t+1]-128)*e+128;i[t+2]=(i[t+2]-128)*e+128}return t},CurvesFilter(t,{x1:e,y1:i,x2:h,y2:l,amount:a}){let s=t.data;if(typeof a==="number"){e=Math.max(Math.min(.5+a/2,1),0);i=Math.min(Math.max(.5-a/2,0),1);h=Math.min(Math.max(.5-a/2,0),1);l=Math.max(Math.min(.5+a/2,1),0)}const r={};const n=t=>{if(!(t in r)){r[t]=c.bezierByX(e,i,h,l,t/255)[1]*255}return r[t]};for(let t=0;t<s.length;t=t+4){s[t]=n(s[t]);s[t+1]=n(s[t+1]);s[t+2]=n(s[t+2])}return t},DisplacementFilter(t,{displace:e}){let i=new ImageData(t.data.slice(0),t.width);let{data:h,width:l,height:a}=i;for(let h=0;h<a;h++){for(let a=0;a<l;a++){let[l,s]=e(a,h);let r=b(t,a-l,h-s,"hold");M(i,a,h,...r)}}return i},ProjectionFilter(t,{project:e}){let i=new ImageData(t.data.slice(0),t.width);let{data:h,width:l,height:a}=i;for(let h=0;h<a;h++){for(let a=0;a<l;a++){let[l,s]=e(a,h);let r=b(t,l,s,"hold");M(i,a,h,...r)}}return i}};t.Stack=x;t.filters=F;t.utils=c;return t}({});
